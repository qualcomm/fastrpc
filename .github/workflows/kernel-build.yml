name: Nightly Kernel Build

# Trigger the workflow on push or pull request to main or development branches
on:
  push:
    branches:
      - 'main'
      - 'development'
  pull_request:
    branches:
      - 'main'
      - 'development'

jobs:
  build-kernel:
    runs-on: ubuntu-22.04
    steps:
      - name: 1. Checkout Linux Kernel Source
        run: |
          git clone https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git linux

      - name: 2. Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y tar xz-utils llvm clang lld llvm-dev
          sudo apt-get install -y build-essential gcc g++ make libelf-dev flex bison util-linux
          sudo apt-get install -y autoconf automake libtool automake 

      - name: 3. Build Linux Kernel
        run: |
          cd linux
          umask 0022
          make LLVM=1 ARCH=arm64 defconfig
          make LLVM=1 ARCH=arm64 -j$(nproc) dir-pkg INSTALL_MOD_STRIP=1

      - name: 4. Upload Kernel Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: linux-kernel-artifacts
          path: |
            linux/arch/arm64/boot/Image
            linux/arch/arm64/boot/dts/qcom/**
            linux/tar-install/**
